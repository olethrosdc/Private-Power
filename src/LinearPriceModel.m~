## -*- Mode: octave -*-

M.elasticity = 0.1;
M.ask = 100;
M.cost = 0.5;
M.baseline = 0.1;

function x = Demand(price, M)
  x = M.ask - M.elasticity .* price;
end

function u = Util(p, M)
  u = (p - M.cost) .* (Demand(p, M) + M.baseline);
end

function p_opt = OptimalPrice(M)
  p_opt = 0.5 * ((M.ask + M.baseline) / M.elasticity + M.cost);
end


function Results = ExponentialResults(Epsilons, M)
  k = 1;
  p = [0:100]/10;
  u = Util(p, M);
  for epsilon=Epsilons;
	Pr = exp(epsilon .* u  / Delta);
	Pr /= sum(Pr);
	Eu(k) = Pr* u';
	Ep(k) = Pr* p';
	k++;
  end
  Results.Eu = Eu;
  Results.Ep = Ep;
end


epsilon = 0.1;
Delta = 1 ./ M.elasticity - M.cost;
Pr = exp(epsilon .* u  / Delta);
Pr /= sum(Pr);

printf("Maximum achievable utility: %f\n", max(u));
k = 1;
clear Eu;
clear Ep;
Epsilons = [0:10];
ExpResults = ExponentialResults(Epsilons, M);



plot(p, u);
xlabel("$\\price$", "interpreter", "none");
ylabel("$\\util$", "interpreter", "none");
							   #print("-dtikz", "price-utility.tikz");
matlab2tikz("width", "0.5\\textwidth", "price-utility.tikz");


plot(Epsilons, Ep, '--;$\\price$;', Epsilons, Eu, ';$\\utility$;', "interpreter", "none");
xlabel("$\epsilon$", "interpreter", "none");

matlab2tikz("width", "0.5\\textwidth", "epsilon-utility.tikz");
